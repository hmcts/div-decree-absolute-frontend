<!-- Javascript -->
{% if features.antennaWebchat and i18n.currentLanguage == "en" %}
<script src="https://{{ antennaWebchat.url }}/chat-client/1/app-es2015.js" type="module"
        integrity="{{ antennaWebchat.integrityCodeEs2015 }}"
        crossorigin="anonymous"></script>
<script src="https://{{ antennaWebchat.url }}/chat-client/1/app-es5.js" nomodule defer
        integrity="{{ antennaWebchat.integrityCodeEs5 }}"
        crossorigin="anonymous"></script>
<script>
  (function() {
    const button = document.querySelector('.chat-button');
    const webChat = document.querySelector('web-chat');
    const message = document.querySelector('#metrics');

    button.addEventListener('click', () => {
      webChat.classList.remove('hidden');
    });

    webChat.addEventListener('hide', () => {
      webChat.classList.add('hidden');
    });

    webChat.addEventListener('metrics', function(metrics) {
      const metricsDetail = metrics.detail;
      const ccState = metricsDetail.contactCenterState;
      const ewt = metricsDetail.ewt;
      const availableAgents = metricsDetail.availableAgents;

      console.log(`Webchat State is: (${ccState}), EWT is: (${ewt}), Available agents is: (${availableAgents})`);
      if (ccState !== 'Open') {
        message.innerHTML = 'Web chat is now closed. Come back Monday to Friday 9am to 5pm. Or contact us using one of the ways below.';
        button.classList.add('hidden');
      } else if (ewt < 300 && availableAgents > 0) {
        message.innerHTML = '';
        button.classList.remove('hidden');
      } else {
        message.innerHTML = 'All our webchat QMCAs are busy helping other people. Please try again later or contact us using one of the ways below.';
        button.classList.add('hidden');
      }
    });

  }).call(this);
</script>
{% endif %}
